<mvc:View
	controllerName="paymentprototype.controller.payment_prototype"
	xmlns:mvc="sap.ui.core.mvc"
	xmlns:core="sap.ui.core"
	xmlns="sap.m"
	displayBlock="true"
	height="100%">
	<Page id="paymentPage" title="Hostel Payment System" showHeader="true">
		<content>
			<!-- Welcome Bar Section -->
			<Panel 
				id="welcomePanel" 
				backgroundDesign="Solid" 
				width="auto" 
				class="sapUiResponsiveMargin sapUiSmallMarginBottom">
				<content>
					<VBox class="sapUiSmallMargin">
						<!-- Heading with Avatar -->
						<HBox alignItems="Center" class="sapUiTinyMarginBottom">
							<Avatar 
								src="sap-icon://employee" 
								displaySize="XS" 
								class="sapUiTinyMarginEnd"/>
							<Title 
								text="Welcome, Choh Jing Yi" 
								level="H3"/>
						</HBox>
						
						<!-- Expanded Content -->
						<HBox alignItems="Center">
							<Label 
								text="Student ID: A23CS0296" 
								class="sapUiTinyMarginEnd"/>
							<Label text="Bachelor of Computer Science"/>
						</HBox>
					</VBox>
				</content>
			</Panel>

			<!-- Unified Dashboard Widget Panel -->
			<Panel 
				id="dashboardPanel" 
				backgroundDesign="Solid" 
				width="auto" 
				class="sapUiResponsiveMargin">
				<content>
					<!-- The Big Amount -->
					<VBox id="headerVBox" alignItems="Center" class="sapUiMediumMarginTop">
						<Label 
							id="totalLabel" 
							text="Total Outstanding" 
							design="Bold" 
							class="sapUiSmallMarginBottom"/>
						<ObjectNumber
							id="totalOutstandingNumber"
							number="{/totalOutstanding}"
							unit="RM"
							emphasized="true"
							state="Error"
							class="sapMObjectNumberLarge"
							style="font-size: 8rem; font-weight: 900;"/>
					</VBox>

					<!-- Status Row -->
					<HBox id="statusHBox" justifyContent="SpaceAround" class="sapUiMediumMarginTop sapUiMediumMarginBottom">
						<!-- Overdue Status -->
						<VBox alignItems="Center" class="sapUiSmallMargin">
							<core:Icon src="sap-icon://error" size="2.5rem" color="#d32f2f"/>
							<Text text="Overdue" class="sapUiTinyMarginTop"/>
							<ObjectNumber
								id="overdueCount"
								number="{/overdueCount}"
								emphasized="true"
								state="Error"
								class="sapUiTinyMarginTop"/>
						</VBox>
						
						<ToolbarSeparator id="sep1"/>
						
						<!-- Pending Status -->
						<VBox alignItems="Center" class="sapUiSmallMargin">
							<core:Icon src="sap-icon://alert" size="2.5rem" color="#ed6c02"/>
							<Text text="Pending" class="sapUiTinyMarginTop"/>
							<ObjectNumber
								id="pendingCountNum"
								number="{/pendingCount}"
								emphasized="true"
								state="Warning"
								class="sapUiTinyMarginTop"/>
						</VBox>
						
						<ToolbarSeparator id="sep2"/>
						
						<!-- Paid Status -->
						<VBox alignItems="Center" class="sapUiSmallMargin">
							<core:Icon src="sap-icon://sys-enter-2" size="2.5rem" color="#2e7d32"/>
							<Text text="Paid" class="sapUiTinyMarginTop"/>
							<ObjectNumber
								id="paidCountNum"
								number="{/paidCount}"
								emphasized="true"
								state="Success"
								class="sapUiTinyMarginTop"/>
						</VBox>
					</HBox>
				</content>
			</Panel>

			<!-- Warning Messages -->
			<VBox id="alertsVBox" class="sapUiSmallMargin">
				<MessageStrip
					id="overdueMessageStrip"
					text="{/overdueCount} payment is overdue. Please settle immediately."
					type="Error"
					showIcon="true"
					visible="{= ${/overdueCount} > 0 }"
					class="sapUiTinyMarginBottom"/>
				<MessageStrip
					id="upcomingMessageStrip"
					text="{/upcomingCount} payment(s) due within 3 days."
					type="Warning"
					showIcon="true"
					visible="{= ${/upcomingCount} > 0 }"
					class="sapUiTinyMarginBottom"/>
			</VBox>

			<!-- Tab Bar -->
			<IconTabBar
				id="billsTabBar"
				select=".onTabSelect"
				class="sapUiResponsiveMargin">
				<items>
					<IconTabFilter
						id="allTab"
						key="All"
						text="All"
						count="{/allCount}"/>
					<IconTabSeparator id="tabSeparator1"/>
					<IconTabFilter
						id="overdueTab"
						key="Overdue"
						text="Overdue"
						count="{/overdueCount}"
						iconColor="Negative"/>
					<IconTabFilter
						id="pendingTab"
						key="Pending"
						text="Pending"
						count="{/pendingCount}"
						iconColor="Critical"/>
				</items>
			</IconTabBar>

			<!-- Bills Table -->
			<Table
				id="billsTable"
				items="{
					path: 'bills>/',
					sorter: { path: 'dueDate' }
				}"
				mode="None"
				class="sapUiResponsiveMargin">
				<headerToolbar>
					<Toolbar id="tableToolbar">
						<Title id="tableTitle" text="Your Bills" level="H4"/>
					</Toolbar>
				</headerToolbar>
				<columns>
					<Column id="descriptionCol" width="30%">
						<Text id="descriptionColHeader" text="Fee Description"/>
					</Column>
					<Column id="dueDateCol" width="15%">
						<Text id="dueDateColHeader" text="Due Date"/>
					</Column>
					<Column id="amountCol" width="15%">
						<Text id="amountColHeader" text="Amount"/>
					</Column>
					<Column id="statusCol" width="15%">
						<Text id="statusColHeader" text="Status"/>
					</Column>
					<Column id="actionsCol" width="25%">
						<Text id="actionsColHeader" text="Actions"/>
					</Column>
				</columns>
				<items>
					<ColumnListItem id="billItem">
						<cells>
							<VBox id="descriptionVBox">
								<Text id="feeTypeText" text="{bills>feeType}" class="sapUiTinyMarginBottom"/>
								<Text id="feeDescText" text="{bills>description}" class="sapUiTinyText"/>
							</VBox>
							<Text id="dueDateText" text="{bills>dueDate}"/>
							<Text
								id="amountText"
								text="{bills>currency}{bills>amount}"
								class="sapUiMediumMarginBegin sapUiMediumFontSize"
								style="font-weight: bold; color: #000;"/>
							<ObjectStatus
								id="statusObject"
								text="{bills>status}"
								state="{path: 'bills>status', formatter: '.formatStatus'}"
								icon="{path: 'bills>status', formatter: '.formatStatusIcon'}"/>
							<HBox id="actionButtonsHBox">
								<Button
									id="payNowBtn"
									text="Pay Now"
									type="Emphasized"
									icon="sap-icon://payment-approval"
									press=".onPayNow"
									visible="{= ${bills>status} !== 'Paid' }"/>
								<Button
									id="downloadReceiptBtn"
									text="Download"
									icon="sap-icon://download"
									tooltip="Download Receipt"
									press=".onDownloadReceipt"
									visible="{= ${bills>status} === 'Paid' }"/>
							</HBox>
						</cells>
					</ColumnListItem>
				</items>
			</Table>
		</content>
	</Page>
</mvc:View>
