<mvc:View
	controllerName="paymentprototype.controller.payment_prototype"
	xmlns:mvc="sap.ui.core.mvc"
	xmlns:core="sap.ui.core"
	xmlns="sap.m"
	displayBlock="true"
	height="100%">
	<Page id="paymentPage" title="Hostel Payment System" showHeader="true">
		<content>
			<!-- Header Section with Large Outstanding Amount -->
			<VBox id="headerVBox" class="sapUiMediumMargin" alignItems="Center">
				<Title id="totalTitle" text="Total Outstanding" level="H2" class="sapUiSmallMarginBottom"/>
				<ObjectNumber
					id="totalOutstandingNumber"
					number="{/totalOutstanding}"
					unit="RM"
					emphasized="true"
					state="Warning"
					class="sapUiLargeText"
					style="font-size: 3rem; font-weight: bold;"/>
			</VBox>

			<!-- Stats Cards Section -->
			<HBox id="statsHBox" justifyContent="SpaceAround" class="sapUiSmallMarginBegin sapUiSmallMarginEnd sapUiMediumMarginBottom">
				<!-- Overdue Card -->
				<VBox id="overdueCard" alignItems="Center" class="sapUiSmallMargin" style="flex: 1; padding: 1.5rem; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #d32f2f;">
					<core:Icon src="sap-icon://error" size="2rem" color="#d32f2f"/>
					<Title id="overdueTitle" text="Overdue" level="H5" class="sapUiTinyMarginTop"/>
					<ObjectNumber
						id="overdueCount"
						number="{/overdueCount}"
						emphasized="true"
						state="Error"
						class="sapUiSmallMarginTop"/>
				</VBox>

				<!-- Pending Card -->
				<VBox id="pendingCard" alignItems="Center" class="sapUiSmallMargin" style="flex: 1; padding: 1.5rem; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #ed6c02;">
					<core:Icon src="sap-icon://alert" size="2rem" color="#ed6c02"/>
					<Title id="pendingTitle" text="Pending" level="H5" class="sapUiTinyMarginTop"/>
					<ObjectNumber
						id="pendingCountNum"
						number="{/pendingCount}"
						emphasized="true"
						state="Warning"
						class="sapUiSmallMarginTop"/>
				</VBox>

				<!-- Paid Card -->
				<VBox id="paidCard" alignItems="Center" class="sapUiSmallMargin" style="flex: 1; padding: 1.5rem; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #2e7d32;">
					<core:Icon src="sap-icon://sys-enter-2" size="2rem" color="#2e7d32"/>
					<Title id="paidTitle" text="Paid" level="H5" class="sapUiTinyMarginTop"/>
					<ObjectNumber
						id="paidCountNum"
						number="{/paidCount}"
						emphasized="true"
						state="Success"
						class="sapUiSmallMarginTop"/>
				</VBox>
			</HBox>

			<!-- Warning Messages -->
			<VBox id="alertsVBox" class="sapUiSmallMargin">
				<MessageStrip
					id="overdueMessageStrip"
					text="{/overdueCount} payment is overdue. Please settle immediately."
					type="Error"
					showIcon="true"
					visible="{= ${/overdueCount} > 0 }"
					class="sapUiTinyMarginBottom"/>
				<MessageStrip
					id="upcomingMessageStrip"
					text="{/upcomingCount} payment(s) due within 3 days."
					type="Warning"
					showIcon="true"
					visible="{= ${/upcomingCount} > 0 }"
					class="sapUiTinyMarginBottom"/>
			</VBox>

			<!-- Tab Bar -->
			<IconTabBar
				id="billsTabBar"
				select=".onTabSelect"
				class="sapUiResponsiveMargin">
				<items>
					<IconTabFilter
						id="allTab"
						key="All"
						text="All"
						count="{/allCount}"/>
					<IconTabSeparator id="tabSeparator1"/>
					<IconTabFilter
						id="overdueTab"
						key="Overdue"
						text="Overdue"
						count="{/overdueCount}"
						iconColor="Negative"/>
					<IconTabFilter
						id="pendingTab"
						key="Pending"
						text="Pending"
						count="{/pendingCount}"
						iconColor="Critical"/>
				</items>
			</IconTabBar>

			<!-- Bills Table -->
			<Table
				id="billsTable"
				items="{
					path: 'bills>/',
					sorter: { path: 'dueDate' }
				}"
				mode="None"
				class="sapUiResponsiveMargin">
				<headerToolbar>
					<Toolbar id="tableToolbar">
						<Title id="tableTitle" text="Your Bills" level="H4"/>
					</Toolbar>
				</headerToolbar>
				<columns>
					<Column id="descriptionCol" width="30%">
						<Text id="descriptionColHeader" text="Fee Description"/>
					</Column>
					<Column id="dueDateCol" width="15%">
						<Text id="dueDateColHeader" text="Due Date"/>
					</Column>
					<Column id="amountCol" width="15%">
						<Text id="amountColHeader" text="Amount"/>
					</Column>
					<Column id="statusCol" width="15%">
						<Text id="statusColHeader" text="Status"/>
					</Column>
					<Column id="actionsCol" width="25%">
						<Text id="actionsColHeader" text="Actions"/>
					</Column>
				</columns>
				<items>
					<ColumnListItem id="billItem">
						<cells>
							<VBox id="descriptionVBox">
								<Text id="feeTypeText" text="{bills>feeType}" class="sapUiTinyMarginBottom"/>
								<Text id="feeDescText" text="{bills>description}" class="sapUiTinyText"/>
							</VBox>
							<Text id="dueDateText" text="{bills>dueDate}"/>
							<Text
								id="amountText"
								text="{bills>currency}{bills>amount}"
								class="sapUiMediumMarginBegin sapUiMediumFontSize"
								style="font-weight: bold; color: #000;"/>
							<ObjectStatus
								id="statusObject"
								text="{bills>status}"
								state="{path: 'bills>status', formatter: '.formatStatus'}"
								icon="{path: 'bills>status', formatter: '.formatStatusIcon'}"/>
							<HBox id="actionButtonsHBox">
								<Button
									id="payNowBtn"
									text="Pay Now"
									type="Emphasized"
									icon="sap-icon://payment-approval"
									press=".onPayNow"
									visible="{= ${bills>status} !== 'Paid' }"/>
								<Button
									id="downloadReceiptBtn"
									text="Download"
									icon="sap-icon://download"
									tooltip="Download Receipt"
									press=".onDownloadReceipt"
									visible="{= ${bills>status} === 'Paid' }"/>
							</HBox>
						</cells>
					</ColumnListItem>
				</items>
			</Table>
		</content>
	</Page>
</mvc:View>
